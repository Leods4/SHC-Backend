Documenta√ß√£o da API - Sistema de Horas Complementares (SHC)1. Vis√£o GeralAPI RESTful desenvolvida para ser o backend de um sistema de gerenciamento de atividades complementares. A API oferece uma interface robusta para ser consumida por uma aplica√ß√£o frontend (ex: React, Vue, Angular), gerenciando usu√°rios, cursos, e o ciclo de vida de certificados.Framework: Laravel 12Banco de Dados: PostgreSQLAutentica√ß√£o: Laravel Sanctum (API Tokens)Plataforma de Deploy (Sugerida): Render2. Configura√ß√£o e Execu√ß√£o LocalPr√©-requisitos: PHP 8.2+, Composer, PostgreSQL.Clonar o reposit√≥rio:git clone [https://github.com/Leods4/SHC-Backend.git](https://github.com/Leods4/SHC-Backend.git)
cd SHC-Backend
Instalar depend√™ncias:composer install
Configurar o ambiente:Copie o arquivo de exemplo: cp .env.example .envAbra o arquivo .env e configure as vari√°veis do banco de dados (DB_HOST, DB_PORT, DB_DATABASE, DB_USERNAME, DB_PASSWORD).Gerar a chave da aplica√ß√£o:php artisan key:generate
Executar as migra√ß√µes do banco de dados:php artisan migrate
Criar o link de armazenamento (ESSENCIAL para uploads):Este comando torna os arquivos enviados (certificados) acess√≠veis publicamente.php artisan storage:link
Iniciar o servidor local:php artisan serve
A API estar√° dispon√≠vel em http://localhost:8000.3. Funcionalidades e Detalhes de Implementa√ß√£oEsta se√ß√£o detalha as principais funcionalidades e como as regras de neg√≥cio foram implementadas.3.1 üîê Autentica√ß√£o e Autoriza√ß√£oAutentica√ß√£o (AuthController): Implementa registro, login, logout e renova√ß√£o de tokens (refreshToken) utilizando Laravel Sanctum. As rotas s√£o protegidas pelo middleware auth:sanctum.Autoriza√ß√£o (Policies): A especifica√ß√£o pedia para "restringir o acesso... utilizando Policies". A implementa√ß√£o real definiu as seguintes regras de neg√≥cio em classes Policy dedicadas:UsuarioPolicy.php: Define que um usu√°rio pode editar a si mesmo, mas apenas um ADMINISTRADOR pode deletar outros usu√°rios. SECRETARIA e COORDENADOR possuem permiss√µes de visualiza√ß√£o ampliadas.CursoPolicy.php: Apenas ADMINISTRADOR e SECRETARIA podem criar ou deletar cursos, enquanto COORDENADOR pode atualiz√°-los.CertificadoPolicy.php: Cont√©m a l√≥gica mais complexa. Apenas ALUNOS podem criar certificados, e s√≥ podem edit√°-los se o status for ENTREGUE. A avalia√ß√£o √© restrita a COORDENADOR, SECRETARIA e ADMINISTRADOR.3.2 üì¶ Gest√£o de Certificados e UploadsUploads (CertificadoController): A rota POST /api/certificados processa requisi√ß√µes multipart/form-data para o upload de arquivos. O arquivo √© armazenado em storage/app/public/certificados e o caminho √© salvo no banco de dados.Valida√ß√£o (StoreCertificadoRequest): A especifica√ß√£o pedia "Valida√ß√£o... via classes FormRequest". A implementa√ß√£o garante que o arquivo seja do tipo PDF e tenha um tamanho m√°ximo de 5MB. Tamb√©m impede que certificados sejam submetidos com data futura.3.3 üßæ Hist√≥rico Autom√°tico de Altera√ß√µesRastreamento (Observers): A especifica√ß√£o pedia para "utilizar Model Observers". Foram criados UsuarioObserver e CertificadoObserver para "escutar" eventos do Eloquent (created, updated, deleted).Como Funciona: No evento updated, o observer utiliza getChanges() para registrar apenas os campos que foram alterados. No evento created, o estado completo do novo registro √© salvo. Em todos os casos, Auth::id() √© usado para registrar quem realizou a a√ß√£o, criando um log de auditoria completo e autom√°tico.3.4 üßÆ C√°lculo de Horas e FiltrosC√°lculo de Progresso (UsuarioController@showProgresso): Endpoint dedicado que soma as horas_validadas de todos os certificados APROVADOS de um aluno e retorna o total, junto com as horas necess√°rias do curso.Filtros e Buscas (index methods): Os m√©todos index dos controladores (ex: CertificadoController) suportam filtros via query parameters, como ?status=APROVADO, permitindo buscas din√¢micas na API.3.5 üèóÔ∏è Arquitetura e Componentes de Liga√ß√£oEnums (app/Enums): Foram utilizados PHP Enums para garantir a consist√™ncia e integridade dos dados para pap√©is de usu√°rio, status e categorias de certificados. Eles servem como a "fonte da verdade", evitando o uso de strings m√°gicas no c√≥digo.Provedores de Servi√ßo (app/Providers):AuthServiceProvider.php: Este arquivo √© respons√°vel por "registrar" as Policies. √â aqui que mapeamos um Modelo (Usuario::class) √† sua respectiva Policy (UsuarioPolicy::class), informando ao Laravel como autorizar a√ß√µes.AppServiceProvider.php: Este provedor registra os Observers. Ao vincular Usuario::class a UsuarioObserver::class, garantimos que o observer seja acionado automaticamente sempre que um usu√°rio for criado, atualizado ou deletado.Configura√ß√£o de CORS e Sanctum:Para permitir a comunica√ß√£o com o frontend, o arquivo config/cors.php foi ajustado para permitir a origem do cliente e suportar credenciais (supports_credentials = true).Adicionalmente, a vari√°vel SANCTUM_STATEFUL_DOMAINS no arquivo .env foi configurada para informar ao Sanctum quais dom√≠nios frontend podem fazer requisi√ß√µes autenticadas.4. Refer√™ncia da API (Endpoints)Rotas P√∫blicasM√©todoEndpointDescri√ß√£oPOST/api/auth/registerRegistra um novo usu√°rio.POST/api/auth/loginAutentica um usu√°rio e retorna um token.Rotas Protegidas (Exigem Bearer Token)M√©todoEndpointDescri√ß√£oPOST/api/auth/logoutFaz logout do usu√°rio (revoga o token).POST/api/auth/refreshGera um novo token de acesso.GET/api/usuariosLista todos os usu√°rios.POST/api/usuariosCria um novo usu√°rio.GET/api/usuarios/{id}Exibe um usu√°rio espec√≠fico.PUT/api/usuarios/{id}Atualiza um usu√°rio.DELETE/api/usuarios/{id}Deleta um usu√°rio.GET/api/usuarios/{id}/progressoMostra o progresso de horas do usu√°rio.GET/api/usuarios/{id}/historicoMostra o hist√≥rico de altera√ß√µes do usu√°rio.GET/api/cursosLista todos os cursos.POST/api/cursosCria um novo curso.GET/api/cursos/{id}Exibe um curso espec√≠fico.PUT/api/cursos/{id}Atualiza um curso.DELETE/api/cursos/{id}Deleta um curso.GET/api/certificadosLista certificados (Aluno s√≥ v√™ os seus).POST/api/certificadosSubmete um novo certificado (com upload).GET/api/certificados/{id}Exibe um certificado espec√≠fico.PUT/api/certificados/{id}Atualiza um certificado (se ainda n√£o avaliado).DELETE/api/certificados/{id}Deleta um certificado (se ainda n√£o avaliado).PATCH/api/certificados/{id}/avaliarAvalia (aprova/reprova) um certificado.GET/api/certificados/{id}/historicoMostra o hist√≥rico de altera√ß√µes do certificado.5. Estrutura da Aplica√ß√£o (Diagramas)<details><summary><strong>Clique para ver o Diagrama de Modelos (Completo)</strong></summary>classDiagram
    %% --- Enums ---
    class TipoUsuario {
        <<Enumeration>>
        ALUNO
        COORDENADOR
        SECRETARIA
        ADMINISTRADOR
    }
    class StatusCertificado {
        <<Enumeration>>
        ENTREGUE
        APROVADO
        REPROVADO
        APROVADO_COM_RESSALVAS
    }
    class CategoriaCertificado {
        <<Enumeration>>
        CIENTIFICO_ACADEMICA
        SOCIOCULTURAL
        PRATICA_PROFISSIONAL
    }
    %% --- Models ---
    class Usuario {
        +id: int
        +nome: String
        +email: String
        +senha: String (hash)
        +matricula: String
        +data_nascimento: Date
        +tipo: TipoUsuario
        +dados_adicionais: JSON
        +curso_id: int (nullable)
        +fase: int (nullable)
        +curso(): Curso
        +certificados(): List~Certificado~
        +cursosCoordenados(): List~Curso~
        +historicoResponsavel(): List~HistoricoAlteracao~
        +calcularHorasValidadas(): int
    }
   class Curso { 
        +id: int
        +nome: String
        +horasNecessarias: int
        +alunos(): List~Usuario~
        +coordenadores(): List~Usuario~
    }
    class Certificado {
        +id: int
        +usuario_id: int
        +categoria: CategoriaCertificado
        +status: StatusCertificado
        +carga_horaria_solicitada: int
        +horas_validadas: int
        +nome_certificado: String
        +instituicao: String
        +data_emissao: Date
        +observacao: String
        +arquivo: String
        +requerente(): Usuario
        +historico(): List~HistoricoAlteracao~
    }
    class HistoricoAlteracao {
        +id: int
        +responsavel_id: int
        +historicoable_type: String
        +historicoable_id: int
        +alteracao: JSON
        +observacao: String
        +data_alteracao: Date
        +responsavel(): Usuario
        +historicoable(): morphTo
    }
    %% --- Relacionamentos ---
    Usuario "0..*" -- "0..1" Curso : "pertence a"
    Curso "1" -- "0..*" Usuario : "cont√©m alunos"
    Usuario "1" -- "0..*" Certificado : "requer"
    Usuario "1" -- "0..*" HistoricoAlteracao : "√© respons√°vel por"
    Curso "0..*" -- "0..*" Usuario : "√© coordenado por"
    Certificado ..> HistoricoAlteracao : "historicoable"
    Usuario ..> HistoricoAlteracao : "historicoable"
</details><details><summary><strong>Clique para ver o Diagrama de Componentes (Completo)</strong></summary>classDiagram
    %% --- Classes Base Laravel ---
    class Controller { <<Base>> }
    class FormRequest { <<Request>> }
    class ModelObserver { <<Observer>> }
    %% --- Models (Stubs) ---
    class Usuario { <<Model>> }
    class Curso { <<Model>> }
    class Certificado { <<Model>> }
    class HistoricoAlteracao { <<Model>> }
    %% --- Controller de Autentica√ß√£o ---
    class AuthController {
        +register(RegisterRequest $request)
        +login(LoginRequest $request)
        +logout(Request $request)
        +refreshToken(Request $request)
    }
    %% --- Controllers de Recurso ---
    class UsuarioController {
        +index(Request $request)
        +store(StoreUsuarioRequest $request)
        +show(Usuario $usuario)
        +update(UpdateUsuarioRequest $request, Usuario $usuario)
        +destroy(Usuario $usuario)
        +showProgresso(Usuario $usuario)
    }
    class CursoController {
        +index()
        +store(StoreCursoRequest $request)
        +show(Curso $curso)
        +update(UpdateCursoRequest $request, Curso $curso)
        +destroy(Curso $curso)
    }
    class CertificadoController {
        +index(Request $request)
        +store(StoreCertificadoRequest $request)
        +show(Certificado $certificado)
        +update(UpdateCertificadoRequest $request, Certificado $certificado)
        +destroy(Certificado $certificado)
        +avaliar(AvaliarCertificadoRequest $request, Certificado $certificado)
    }
    %% --- Controllers Aninhados ---
    class UsuarioHistoricoController {
        +index(Usuario $usuario)
    }
    class CertificadoHistoricoController {
        +index(Certificado $certificado)
    }
    %% --- Observers para Hist√≥rico ---
    class UsuarioObserver {
      +created(Usuario $usuario)
      +updated(Usuario $usuario)
    }
    class CertificadoObserver {
      +created(Certificado $certificado)
      +updated(Certificado $certificado)
    }
    %% --- Heran√ßa e Depend√™ncias ---
    Controller <|-- AuthController
    Controller <|-- UsuarioController
    Controller <|-- CursoController
    Controller <|-- CertificadoController
    Controller <|-- UsuarioHistoricoController
    Controller <|-- CertificadoHistoricoController
    ModelObserver <|-- UsuarioObserver
    ModelObserver <|-- CertificadoObserver
    
    AuthController ..> Usuario : "cria/autentica"
    AuthController ..> FormRequest : "valida"
    UsuarioController ..> Usuario : "gerencia"
    CursoController ..> Curso : "gerencia"
    CertificadoController ..> Certificado : "gerencia"
    UsuarioObserver ..> Usuario : "observa"
    CertificadoObserver ..> Certificado : "observa"
    UsuarioHistoricoController ..> HistoricoAlteracao : "l√™"
    CertificadoHistoricoController ..> HistoricoAlteracao : "l√™"
</details>
